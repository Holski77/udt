=Multi Rotor Design - User Manual=

This page describes the use of MRD to design or simulate a multi-rotor UAV.

= Introduction =

MRD is an open source software developed in Enac's UAV department in order to design home made rotorcrafts, mainly quadrotors. MRD is based on the Qprop propeller simulator and on the Qmil design tool. It allows the user to simulate an existing vehicle, but also to run batch analysis and to plot the results in order to chose the optimum propeller, motor and battery for a given project.
For people capable of producing propellers, MRD is also capable of designing an optimized propeller to meet your mission constraints. 



= Setup =

How to get MRD operational.

== What you need ==

MRD is developed on linux and thus is for now only available on linux based OS. However it should not be really difficult to port it to windows. 

 # That means that the first thing you need is a computer running with     Ubuntu or other Linux based OS.
 # Install the gfortran-4.5 compiler with the command: *$ sudo apt-get install gfortran-4.5*
 # Install svn (Subversion) in order to download keep the program up to date and submit your work if you want to contribute to this project. To do that use: *$ sudo apt-get install subversion* 
 # In order to have nice graphical output from the software you can install gnuplot using: *$ sudo apt-get install gnuplot* 



== Setup step by step ==

You are now ready to download the source files and compile the software.

 # First you need to create a folder wherever you want to have the program and move inside this folder. For example you can create a UDT folder using the command: *$ mkdir UDT*
 # Move inside this folder using: *$ cd UDT*
 # Then use the following command to register in google code to allow svn to download from the host : *$ svn checkout http://udt.googlecode.com/svn/trunk/ udt-read-only*
 # To update the folder run the command : *$ svn up*

A udt folder will be created, it wil contain all you need to compile and run the software. Inside you will find:
 * *BIN* : the folder in which the binaries and the Makefile are
 * *SRC* : the folder containing the source files
 * *RUNS* : In which you store your propeller, motor, airfoil databases and your simulation configuration file. It will also contain the results once you have run some simulations. 

To compile Go to directory /BIN 
Edit the *Makefile* in order to change the Fortran compiler if necessary (default is the gfortran-4.5). 
Type *$ make* to compile Qprop,Qmil and MRD all together.

MRD is now ready to run.

= Running the software =

== Modes available ==

MRD can be run in three different modes according to what you want to do and what kind of data you have. These three modes are:

 ===Qprop based simulation mode :===
 This mode is meant to simulate multirotor vehicles using calls to Qprop in order to achieve higher precision and additional output. The software will combine propeller and motor models available. The difficult part here is to get an accurate propeller model which can be used by Qprop, i.e. span, cord law and airfoil characteristics. If your propeller is well known you should be able to find it's model using google otherwise you can find a modelisation procedure here http://web.mit.edu/drela/Public/web/qprop/prop_measure.pdf


 In addition the user can create engines model from his experiments or the manufacturer data. The model used is similar to the Qprop model but has two additional coefficients that are relevant for UAV design:

   * *The motor mass* in kg
   * *The maximum working power* in W

 ===Simplified simulation mode :=== 
 In this mode the propeller is described by eight coefficients. This allow the user to create a model for an existing propeller just by doing some basic measurement on it. As it is not calling Qprop this mode is also much faster.
 The coefficients describing the aerodynamic efficiency of the propeller are:
   * *K0_THRUST* in N (~0)
   * *K1_THRUST* in N/RPM
   * *K2_THRUST* in N/RPM^2
   * *K0_TORQUE* in Nm (~0)
   * *K0_TORQUE* in Nm/RPM 
   * *K0_TORQUE* in Nm/RPM^2 

 These coeffiecients can be computed using excel for example and approximating the Thrust(RPM) and Torque(RPM) response with the following second order polynoms:

 Thrust(RPM) = K0_THRUST + K1_THRUST.RPM + K2_THRUST.RPM^2

 Torque(RPM) = K0_TORQUE + K1_TORQUE.RPM + K2_TORQUE.RPM^2

 The last coefficients are the *MASS* in kg and the *RADIUS* of the propeller in meter.


 ===Propeller design mode :=== 
 This mode allow the user to generate propellers using Qmil according to some design constraints, simulate them and sort the ones meeting your mission constraints. The software will output a Qprop-type definition file which can allow you to design and produce an optimal propeller for your aircraft.

 The only inputs this mode need is the aerodynamic coefficients of the airfoils you want to use and the motors models. 


==Running a Simulation==

To run a simulation (or a design procedure) using MRD you need to create a Case folder containing the data and the incoming results. This folder needs to be located in the udt/MRD/RUNS folder. The easiest way to do it is to go inside the RUNS folder duplicate and rename the CASEexp folder. Call it for example SIMU1.

Then move inside this new folder. You will find a Case.run file, a DATA folder and a RESULTS folder. The Case.run file is the configuration file that will contain all the parameters of your simulation. Inside DATA/PROPELLER, DATA/MOTOR or DATA/SIMPLE_PROPELLER just replace the existing models with the ones you want to use.

===Set up a Simulation===

 You can now get back to the Case.run file and open it. In this file you will find various parameters describing the mode you want to use, your aircraft shape, size, the way you want the results to be sorted...

 Here is an overview of all the parameters you need to tune for your simulation:

  * *RUN_MODE* : define the mode in which the software will run. 0 will run the Simplified simulation mode using the SIMPLE_PROPELLER models, 1 will run the Qprop based simulation and 2 will run the propeller design mode.


  System Weights

  * *MASS_PAYLOAD* : define the mass in kg of the payload you intend to carry

  * *MASS_AVIONICS* : define the mass in kg of your autopilot system (with sensors, modem, engine controllers...)

  * *MASS_MISC* : various additional weight in kg


  Energy Source 

  * *BATT_SPEC_ENERGY* : is the ratio of energy in Wh that contains your battery over it's mass. To approximate the energy contained in a battery just multiply it's capacity in Ah by the mean voltage during use (~11V fos a 3 cells Lipo).

  * *BATT_MASS_MULTIPLIER* : define the battery mass, you can enter here three values if you want the simulator to loop on the battery size. Enter the starting mass, the maximum mass, and delta. If you don't want to loop just use the same value for the minimum and maximum mass.

  * *BATT_MAX_VOLT* : the nominal voltage of your battery in V (12V for a 3 cells Lipo)

  Power Consumption

  * *AVIONICS_POWER* : define the power consumption of the autopilot/stabilization system in W.

  * *PAYLOAD_POWER* : power of payload in W

  Frame Specs

  * *FRAME_FIX_MASS* : Is the mass in kg of your aircraft frame. If you let 0 the software will estimate it (for quad rotors only) according to the following parameters.

  * *NR_MOTOR* : number of motors (and propellers) of your aircraft

  * *FRAME_MAT* : Frame material. 0:carbon,1:aluminum,2:EPP

  * *FRAME_SHAPE* : Define the shape of the frame. 0:cross, 1:round 

  * *TIP_CLRNCE* : Define the minimal clearance between the propellers tips

  * *FRAME_FIX_SIZE* : The span in m that will be used for your quad frame. The simulator will use this frame size and reject all the propellers to large to fit according to the tip clearance you set. Put 0 to let the simulator find the most compact frame for each propellers.

  * *MAX_FRAME_SIZE* : The maximal span of the quad frame. The simulator will reject all configurations exceeding this limit. Leave 0 to keep all configurations.